@page "/upload"
@using AutoJobApplication.Data
@using AutoJobApplication.Interfaces
@inject IFileUploadService FileUploadService
@inject FileStateService FileStateService

<h3>Upload Your CV</h3>
<InputFile OnChange="HandleFileSelected" />
@if (!string.IsNullOrEmpty(UploadMessage))
{
    <p>@UploadMessage</p>
}

@code {
    private string UploadMessage;

    private async Task HandleFileSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file != null && (file.ContentType == "application/pdf" || file.ContentType == "application/vnd.openxmlformats-officedocument.wordprocessingml.document"))
        {
            // Store the uploaded file in the state service
            FileStateService.SetUploadedFile(file);

            var result = await FileUploadService.UploadFileAsync(file);
            if (result != null && result.Length > 0)
            {
                UploadMessage = "File uploaded successfully.";
            }
            else
            {
                UploadMessage = "File upload failed.";
            }
        }
        else
        {
            UploadMessage = "Invalid file format. Please upload a DOCX or PDF file.";
        }
    }
}
